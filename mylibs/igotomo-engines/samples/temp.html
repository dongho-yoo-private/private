[39m<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>Google Gmail APIでメールを取得する - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Gmail APIでメールを取得するまで色々苦労したのでメモ
なんか知らないうちにOAuth2やら何やら色々しなくてはいけなくなったのね。。。


参考にしたサイト


Gmail APIを使ってメール送信するVBAマクロ(2)
Gmail の Google API を使ってみました



Google Developpers Consoleとは？

Googleの開発者向けに色々設定やら何やらをする所
APIを使いたい場合も必要です


Google Developp..." name="description" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="ryurock3" name="twitter:creator" /><meta content="Google Gmail APIでメールを取得する - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="http://qiita.com/ryurock/items/4b063372ede81780c3c8" property="og:url" /><meta content="http://cdn.qiita.com/assets/qiita-fb-d4344e5e3d6556dbd88d92e8a89b8803.png" property="og:image" /><meta content="
Gmail APIでメールを取得するまで色々苦労したのでメモ
なんか知らないうちにOAuth2やら何やら色々しなくてはいけなくなったのね。。。

## 参考にしたサイト

* [Gmail APIを使ってメール送信するVBAマクロ(..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link href="/icons/favicons/public/production.ico?v=4" rel="shortcut icon" type="image/x-icon" /><link href="/icons/favicons/public/apple-touch-icon.png" rel="apple-touch-icon" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/public_vender-1a69d19be893dac688663715a952c15b.css" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/application-62933789d997047647f3099355312109.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="GbSxNz6HShUd1ndZ0RzESNjpLA3hgcBvmcl+C+7ae9BefE7Bj0FrJ0jdSKJKEdJhYj5lS2N/8oC3Zs1jIMCq7g==" /></head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';

  // Application Namespace
  var Qiita = {
    startTime: Date.now(),
    controllerPath: 'items',
    controllerAction: 'items#show',
    controller: 'items',
    action: 'show',
    env: 'production',
    flash: {},
    config: {
      mixpanel: {"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"}
    },

    // Fake jQuery
    // Emulate $.ready(fn) in views before load jQuery.
    _q: [],
    // The ready function that collect calls and put it in the queue
    ready: function (func) {
      if (typeof func==='function') Qiita._q.push(func);
      // return jQl in order to support jQuery(document).ready()
      return Qiita
    },
    // Run all queues inline $.ready() calls in the right order and purge the
    // queue
    unqueue: function () {
      for (var i = 0, l = Qiita._q.length; i < l; i++) Qiita._q[i]();
      Qiita._q = [];
    }
  };



  var $ = Qiita.ready, jQuery = $;
</script>
<header class="navbar navbar-default navbar-static-top" role="navigation"><div class="container"><div class="navbar-header navigationBar_header"><a class="navbar-brand siteBrand-public" href="/"><img class="siteBrand-publicLogo" src="http://cdn.qiita.com/assets/siteid-reverse-afd514cf9dada4652217c56e963cb7b1.png" /></a></div><form class="navbar-form navbar-left hidden-xs searchForm js-globalSearchForm" action="/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" /><div class="searchForm_queryWrapper"><input type="text" name="q" id="q" placeholder="キーワードを入力" class="form-control searchForm_query js-globalSearchForm_query" /><div class="searchForm_wiseSearchButton js-wise-search"><i class="fa fa-caret-down"></i><i class="fa fa-spinner fa-spin"></i></div><div class="searchQuerySupport js-globalSearchForm_stockedSearch"><div class="searchQuerySupport_userSearch"><label class="searchQuerySupport_label">ユーザーを指定</label><input class="js-user-query searchQuerySupport_input" placeholder="例) qiitan" /></div><div class="searchQuerySupport_tagSearch"><label class="searchQuerySupport_label">タグを指定</label><input class="js-tag-query searchQuerySupport_input" placeholder="例) Ruby フレームワーク" /></div><div class="searchQuerySupport_sort"><div class="searchQuerySupport_sortLabel">ソート</div><select class="js-sort-type" name="sort"><option selected="selected" value="rel">関連度順</option><option value="created">新規投稿順</option><option value="stock">ストック数降順</option></select></div><label class="checkbox searchQuerySupport_stocked"><input type="checkbox" name="stocked" id="stocked" value="1" class="js-stock-only searchQuerySupport_checkbox" />ストックした投稿で絞り込む</label></div></div><input type="submit" name="commit" value="検索" class="btn btn-default btn-sm searchForm_submitBtn js-globalSearchForm_submitBtn" /></form><div class="navbar-text headerNews hidden-xs hidden-sm"><div class="headerNews_label label label-warning">Hot</div><a target="_blank" class="navbar-link" href="https://teams.qiita.com?utm_source=qiita&amp;utm_medium=header_news">Markdownによる情報共有サービス、Qiita:Team</a></div><ul class="nav navbar-nav navbar-right navigationBar_menu"><li><a track="click" data-label="LoginButtonAtNavbar" href="/login?redirect_to=%2Fryurock%2Fitems%2F4b063372ede81780c3c8">ログイン</a></li></ul><a class="btn btn-warning navbar-btn navbar-right" track="click" data-event-name="Signup Button Click" data-label="SignupButtonAtNavbar" href="/signup?redirect_to=%2Fryurock%2Fitems%2F4b063372ede81780c3c8">ユーザ登録</a></div></header><div id="main"><ol class="itemBreadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/"><span itemprop="name">Qiita</span></a><meta content="1" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/items"><span itemprop="name">投稿</span></a><meta content="2" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/tags/google"><span itemprop="name">google</span></a><meta content="3" itemprop="position" /></li></ol><article itemscope="" itemtype="http://schema.org/Article"><div class="itemsShowHeader"><div class="container"><div class="row"><div class="col-sm-9"><h1 class="itemsShowHeaderTitle_title" itemprop="name">Google Gmail APIでメールを取得する</h1><ul class="list-unstyled list-inline itemsShowHeaderTags"><li class="itemsShowHeaderTags_list"><div class="tagIcon"><a class="tagIcon_base" href="/tags/google"><img alt="google" class="tagIcon_img" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/ae3230cebcf6f0b2e07ddc83cf4090520944eb1c/medium.jpg?1435295325" /><div class="tagIcon_name">google</div><div class="tagIcon_count">155</div></a></div></li><li class="itemsShowHeaderTags_list"><div class="tagIcon"><a class="tagIcon_base" href="/tags/gmail"><img alt="gmail" class="tagIcon_img" src="http://cdn.qiita.com/assets/icons/medium/missing-ada35b62f39c604a9f412c714ac34fc6.png" /><div class="tagIcon_name">gmail</div><div class="tagIcon_count">53</div></a></div></li><li class="itemsShowHeaderTags_list"><div class="tagIcon"><a class="tagIcon_base" href="/tags/shell"><img alt="shell" class="tagIcon_img" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/043a6bad6c0f074bec8500326daf861698d218ba/medium.jpg?1387909294" /><div class="tagIcon_name">shell</div><div class="tagIcon_count">405</div></a></div></li></ul><ul class="list-unstyled list-inline itemsShowHeaderTitle_status"><li><a href="/ryurock"><img class="itemsShowHeaderTitle_authorIcon" src="https://avatars.githubusercontent.com/u/1619084?v=3" alt="1619084?v=3" /></a><a href="/ryurock">ryurock</a>が<time datetime="2014-12-26T01:29:45+09:00" itemprop="datePublished">2014/12/26</time>に<a href="http://kobito.qiita.com"
target="_blank">Kobito</a>から投稿</li><li class="hidden-xs"><a href="/drafts/4b063372ede81780c3c8/edit">編集リクエストを作成する</a></li></ul></div><div class="col-sm-3"><div class="itemsShowHeaderStock"><ul class="list-unstyled itemsShowHeaderStock_statusList"><li><div class="itemsShowHeaderStock_count stock"><i class="fa fa-stock"></i><span class="js-stocksCount">18</span></div><div class="itemsShowHeaderStock_countText">ストック</div></li><li><div class="itemsShowHeaderStock_count" content="0 UserComments" itemprop="interactionCount"><i class="fa fa-comment-o"></i>0</div><div class="itemsShowHeaderStock_countText">コメント</div></li></ul><span class="js-stockButton itemStockButton" data-counter=".js-stocksCount" data-path="/ryurock/items/4b063372ede81780c3c8" data-position="top" data-uuid="4b063372ede81780c3c8"><form class="button_to" method="post" action="/ryurock/items/4b063372ede81780c3c8/stock"><button class="btn btn-default btn-block itemStockButton_button-stock" type="submit"><i class="fa fa-stock unstock hidden-sm"></i>ストック</button><input type="hidden" name="authenticity_token" value="q95AwIxBmo+/izr6PYutjKygo+siVGv6HW3lQNwBMpHsFr82PYe7veqABQGmhrulFnfqraCqWRUzwlYoEhvjrw==" /></form><div class="btn btn-primary btn-block itemStockButton_button-stocking">ストック済み</div><form class="button_to" method="post" action="/ryurock/items/4b063372ede81780c3c8/unstock"><button class="btn btn-danger btn-block itemStockButton_button-unstock" type="submit">解除</button><input type="hidden" name="authenticity_token" value="A9jSf6DvcAS3FPAVMAryeVt8A5Bv7gqEJ4g+PWSAyghEEC2JESlRNuIfz+6rB+RQ4atK1u0QOGsJJ41VqpobNg==" /></form></span></div><ul class="list-unstyled list-inline itemsShowHeaderStock_stockUsers"><li><a title="shota_low" href="/shota_low"><img alt="shota_low" src="https://pbs.twimg.com/profile_images/459022984678617088/5DQkKt-V_normal.jpeg" /></a></li><li><a title="neiraza" href="/neiraza"><img alt="neiraza" src="https://pbs.twimg.com/profile_images/557244820964388864/kTcWfXvf_normal.jpeg" /></a></li><li><a title="chocopie116" href="/chocopie116"><img alt="chocopie116" src="https://secure.gravatar.com/avatar/e8bf510eb1aaf3cc4af4d85f6cf34396" /></a></li><li><a title="balmychan" href="/balmychan"><img alt="balmychan" src="https://pbs.twimg.com/profile_images/1286698114/KM56TsK9_normal" /></a></li><li><a title="garufu" href="/garufu"><img alt="garufu" src="https://pbs.twimg.com/profile_images/2385085592/8h66x5is0ks09lyvjeup_normal.jpeg" /></a></li><li><a title="ar90n@github" href="/ar90n@github"><img alt="ar90n@github" src="https://secure.gravatar.com/avatar/19510c38910a0ba8baf67550e57f56fc?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" /></a></li><li><a title="kazemas@github" href="/kazemas@github"><img alt="kazemas@github" src="https://secure.gravatar.com/avatar/8edd4b88bb7aa6b7dbdb4b106b8dce01?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" /></a></li><li><a title="yamasaki-masahide" href="/yamasaki-masahide"><img alt="yamasaki-masahide" src="https://secure.gravatar.com/avatar/387b4c0761642ea7c94c5061ada556aa" /></a></li><li><a title="yshiga" href="/yshiga"><img alt="yshiga" src="https://2.gravatar.com/avatar/4e9593821baf844595665c5f7d3fb5a2?d=https%3A%2F%2Fidenticons.github.com%2Fda72f192852304e817a499730a096ff9.png" /></a></li><li><a title="sprechchor44" href="/sprechchor44"><img alt="sprechchor44" src="https://avatars.githubusercontent.com/u/6168817?v=2" /></a></li><a href="/ryurock/items/4b063372ede81780c3c8/stockers"><i class="fa fa-ellipsis-h"></i></a></ul></div></div></div></div><div class="container itemsShowBody"><div class="row scroll-chaser-wrapper"><div class="col-sm-9 itemsShowBody_articleColumn"><section class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" id="item-4b063372ede81780c3c8" itemprop="articleBody"><p>Gmail APIでメールを取得するまで色々苦労したのでメモ<br>
なんか知らないうちにOAuth2やら何やら色々しなくてはいけなくなったのね。。。</p>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://www.ka-net.org/blog/?p=4538">Gmail APIを使ってメール送信するVBAマクロ(2)</a></li>
<li><a href="http://arakanoj.com/gmail-%E3%81%AE-google-api-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%97%E3%81%9F-1034.html">Gmail の Google API を使ってみました</a></li>
</ul>

<h2>
<span id="google-developpers-consoleとは" class="fragment"></span><a href="#google-developpers-console%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Google Developpers Consoleとは？</h2>

<p>Googleの開発者向けに色々設定やら何やらをする所<br>
APIを使いたい場合も必要です</p>

<h2>
<span id="google-developpers-consoleでプロジェクトを作成する" class="fragment"></span><a href="#google-developpers-console%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Google Developpers Consoleでプロジェクトを作成する</h2>

<p><a href="https://console.developers.google.com/project">https://console.developers.google.com/project</a></p>

<p>に行くとプロジェクトを作成ボタンがあるので押してプロジェクトを作成してください。<br>
多分いくつでもプロジェクトは作れると思うので自分は適当にAPI Projectとつけました。</p>

<h2>
<span id="google-developpers-consoleのapiと認証--apiでgmail-apiをonにする" class="fragment"></span><a href="#google-developpers-console%E3%81%AEapi%E3%81%A8%E8%AA%8D%E8%A8%BC--api%E3%81%A7gmail-api%E3%82%92on%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Google Developpers Consoleの【APIと認証 &gt; API】でGmail APIをONにする</h2>

<p>Gmail API という項目があるのでデフォルトがOFFになってるのでONにします。</p>

<h2>
<span id="google-developpers-consoleのapiと認証--認証情報のoauthで新しいクライアントidを作成する" class="fragment"></span><a href="#google-developpers-console%E3%81%AEapi%E3%81%A8%E8%AA%8D%E8%A8%BC--%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AEoauth%E3%81%A7%E6%96%B0%E3%81%97%E3%81%84%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88id%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Google Developpers Consoleの【APIと認証 &gt; 認証情報】のOAuthで新しいクライアントIDを作成する</h2>

<p>自分はhubotに食わせるのが目的なのでバックグラウンドで実行するのが目的なので下記で設定をしました。(目的や用途によって選択は変わると思います。</p>

<ul>
<li>インストールされているアプリケーション</li>
<li>インストールされているアプリケーションの種類

<ul>
<li>その他</li>
</ul>
</li>
</ul>

<h2>
<span id="oauthの許可リクエストページからcodeを取得する" class="fragment"></span><a href="#oauth%E3%81%AE%E8%A8%B1%E5%8F%AF%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%8B%E3%82%89code%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>OAuthの許可リクエストページからcodeを取得する</h2>

<p><a href="https://accounts.google.com/o/oauth2/auth?client_id=%7BOAuth%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88ID%7D&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&amp;scope=https://www.googleapis.com/auth/gmail.readonly&amp;response_type=code&amp;approval_prompt=force&amp;access_type=offline">https://accounts.google.com/o/oauth2/auth?client_id={OAuthのクライアントID}&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&amp;scope=https://www.googleapis.com/auth/gmail.readonly&amp;response_type=code&amp;approval_prompt=force&amp;access_type=offline</a></p>

<p>上記URLをブラウザで実行すると許可リクエストページに遷移しますので承認を押すと<br>
「このコードをコピーし、アプリケーションに切り替えて貼り付けてください」<br>
という簡素なページに遷移しますのでそのコードを控えて置いてください。</p>

<h3>
<span id="scopeについて" class="fragment"></span><a href="#scope%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>scopeについて</h3>

<p>scopeの値になにを入れればいいかわからず自分はハマりました。<br>
簡単にいうと各APIでのパーミッション権限を指定する必要があります。<br>
今回はgmail APiなので<a href="https://developers.google.com/gmail/api/auth/scopes?hl=ja">Gmail scopes</a>からリード権限のスコープにしています。</p>

<h2>
<span id="アクセストークンの取得" class="fragment"></span><a href="#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>アクセストークンの取得</h2>

<p>API実行時に必要なアクセストークンを取得します</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/path/to/hoge</span></div>
<div class="highlight"><pre>curl -d client_id={OAuthのクライアントID} -d client_secret={OAuthのクライアントシークレット} -d redirect_uri=urn:ietf:wg:oauth:2.0:oob -d grant_type=authorization_code -d code={さっき取得したコード} https://accounts.google.com/o/oauth2/token

# レスポンス
{
  "access_token" : "xxxxxxxxxxxxxxxxx",
  "token_type" : "Bearer",
  "expires_in" : 3600,
  "refresh_token" : "xxxxxxxxxxxxxxxxxxxxx"
}
</pre></div>
</div>

<h2>
<span id="リフレッシュトークンからアクセストークンを取得" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%83%83%E3%82%B7%E3%83%A5%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>リフレッシュトークンからアクセストークンを取得</h2>

<p>アクセストークンは30分で切れるらしいので、リフレッシュトークンから新しいトークンを再発行する為の手順です。（別に試すだけならやらなくてもよい)</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/path/to/hoge</span></div>
<div class="highlight"><pre>curl -d "client_id={OAuthのクライアントID}&amp;client_secret={OAuthのクライアントシークレット}&amp;refresh_token={先ほど取得したrefresh_token}&amp;grant_type=refresh_token" https://accounts.google.com/o/oauth2/token

# レスポンス
{
  "access_token" : "xxxxxxxxxxxxxxxxxxxxxxxx",
  "token_type" : "Bearer",
  "expires_in" : 3600
}
</pre></div>
</div>

<p>このアクセストークンはAPI実行時に毎回必要になります。</p>

<h3>
<span id="アクセストークンのパーミッションの確認方法" class="fragment"></span><a href="#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>アクセストークンのパーミッションの確認方法</h3>

<p>アクセストークンのscopeを適切に設定をしていないとAPIを実行した時に<br>
「insufficientPermissions」というレスポンスが返ってきます。</p>

<p>パーミッションを確認するには</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>https://www.googleapis.com/oauth2/v1/tokeninfo?access_token={アクセストークン}
</pre></div></div>

<p>となります。</p>

<h2>
<span id="gmail-メール一覧の取得" class="fragment"></span><a href="#gmail-%E3%83%A1%E3%83%BC%E3%83%AB%E4%B8%80%E8%A6%A7%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>Gmail メール一覧の取得</h2>

<p>詳細は<a href="https://developers.google.com/gmail/api/">Gmail API Users.messages: list</a>で</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/path/to/hoge</span></div>
<div class="highlight"><pre>curl -H "Authorization: Bearer {先ほど取得したアクセストークン}" https://www.googleapis.com/gmail/v1/users/me/messages/

#レスポンス

{
 "messages": [
  {
   "id": "xxxxxx",
   "threadId": "xxxx"
  },
  {
   "id": "xxxxxx",
   "threadId": "xxxx"
  },
  {
   "id": "xxxxxx",
   "threadId": "xxxx"
  },
   .
   .
   .
   .
  {
   "id": "xxxxxx",
   "threadId": "xxxx"
  }
 ],
 "nextPageToken": "xxxxxxxx",
 "resultSizeEstimate": 520
}
</pre></div>
</div>

<p>上記のidで特定のメールのメッセージの詳細を取得できます。</p>

<h2>
<span id="gmail-メール本文の取得" class="fragment"></span><a href="#gmail-%E3%83%A1%E3%83%BC%E3%83%AB%E6%9C%AC%E6%96%87%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>Gmail メール本文の取得</h2>

<p>詳細は<a href="https://developers.google.com/gmail/api/v1/reference/users/messages/get">Gmail API Users.messages: get</a>で</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/path/to/hoge</span></div>
<div class="highlight"><pre>curl -H "Authorization: Bearer {先ほど取得したアクセストークン}" https://www.googleapis.com/gmail/v1/users/me/messages/{メール一覧で取得したid}

# レスポンス(一部抜粋)

 "id": "{メール一覧で取得したid}",
 "threadId": "メールのスレッドID",
 "labelIds": [分類されているラベルID1,分類されているラベルID2],
 "snippet": "本文のスニペット",
 "historyId": "9052307",
 "payload": {
  "partId": "",
  "mimeType": "text/plain",
  "filename": "",
  "headers": [
   {
    "name": "Delivered-To",
    "value": "受信者のメールアドレス"
   },
   {
    "name": "Received",
    "value": "by xx.xx.xx.xxx with SMTP id xxxxxx;        Thu, 25 Dec 2014 07:06:06 -0800 (PST)"
   },
   {
    "name": "X-Received",
    "value": "by xx.xx.xx.xxx with SMTP id xxxxxx;        Thu, 25 Dec 2014 07:05:32 -0800 (PST)"
   },
   {
    "name": "Return-Path",
    "value": "返信先のメールアドレス"
   },
   {
    "name": "From",
    "value": "メールアドレス(From)"
   },
   {
    "name": "to",
    "value": "メールアドレス(To)"
   },
   {
    "name": "Cc",
    "value": ""
   },
   {
    "name": "Date",
    "value": "Fri, 26 Dec 2014 00:05:26 +0900"
   },
   {
    "name": "MIME-Version",
    "value": "1.0"
   },
   {
    "name": "Content-Type",
    "value": "text/plain; charset=\"iso-2022-jp\""
   },
   {
    "name": "Content-Transfer-Encoding",
    "value": "7bit"
   },
   {
    "name": "Subject",
    "value": "メールの件名"
   },
   {
    "name": "Reply-To",
    "value": "返信先メールアドレス"
   },
   {
    "name": "X-Mail-Count",
    "value": "2476689"
   },
   {
    "name": "Precedence",
    "value": "bulk"
   },
   {
    "name": "X-QuickML",
    "value": "true"
   }
  ],
  "body": {
   "size": 1288,
   "data": "本文でベース64エンコードされた本文"
  }
 },
 "sizeEstimate": 3933
}
</pre></div>
</div>

<ul>
<li>メール件名

<ul>
<li>payload.headers[name: "subject"]</li>
</ul>
</li>
<li>メール本文

<ul>
<li>payload.body.data(base64urlエンコードされたもの)</li>
<li>
<a href="http://kjur.github.io/jsjws/tool_b64udec.html">Online Base64URL decoder</a>あたりで確認してみてください</li>
</ul>
</li>
</ul>

<p>になります。</p>

<p>なんか以外とメール取るのに苦労しました。。。。。(自分は)</p>
<div class="hidden"><form class="js-task-list-update" action="/ryurock/items/4b063372ede81780c3c8" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="OF6ZgL/gkoVLejqExocyBeQD0gkdthhwlI606frLSo1/lmZ2Diaztx5xBX9diiQsXtSbT59IKp+6IQeBNNGbsw==" /><input type="hidden" name="updated_at_confirmation_in_unixtime" id="updated_at_confirmation_in_unixtime" value="1419524985" class="js-task-list-updated-at" /><textarea name="raw_body" id="raw_body" class="js-task-list-field">

Gmail APIでメールを取得するまで色々苦労したのでメモ
なんか知らないうちにOAuth2やら何やら色々しなくてはいけなくなったのね。。。

## 参考にしたサイト

* [Gmail APIを使ってメール送信するVBAマクロ(2)](http://www.ka-net.org/blog/?p=4538)
* [Gmail の Google API を使ってみました](http://arakanoj.com/gmail-%E3%81%AE-google-api-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%97%E3%81%9F-1034.html)


## Google Developpers Consoleとは？

Googleの開発者向けに色々設定やら何やらをする所
APIを使いたい場合も必要です

## Google Developpers Consoleでプロジェクトを作成する

https://console.developers.google.com/project

に行くとプロジェクトを作成ボタンがあるので押してプロジェクトを作成してください。
多分いくつでもプロジェクトは作れると思うので自分は適当にAPI Projectとつけました。

## Google Developpers Consoleの【APIと認証 &gt; API】でGmail APIをONにする

Gmail API という項目があるのでデフォルトがOFFになってるのでONにします。

## Google Developpers Consoleの【APIと認証 &gt; 認証情報】のOAuthで新しいクライアントIDを作成する

自分はhubotに食わせるのが目的なのでバックグラウンドで実行するのが目的なので下記で設定をしました。(目的や用途によって選択は変わると思います。

* インストールされているアプリケーション
* インストールされているアプリケーションの種類
 * その他

## OAuthの許可リクエストページからcodeを取得する

https://accounts.google.com/o/oauth2/auth?client_id={OAuthのクライアントID}&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&amp;scope=https://www.googleapis.com/auth/gmail.readonly&amp;response_type=code&amp;approval_prompt=force&amp;access_type=offline


上記URLをブラウザで実行すると許可リクエストページに遷移しますので承認を押すと
「このコードをコピーし、アプリケーションに切り替えて貼り付けてください」
という簡素なページに遷移しますのでそのコードを控えて置いてください。

### scopeについて

scopeの値になにを入れればいいかわからず自分はハマりました。
簡単にいうと各APIでのパーミッション権限を指定する必要があります。
今回はgmail APiなので[Gmail scopes](https://developers.google.com/gmail/api/auth/scopes?hl=ja)からリード権限のスコープにしています。


## アクセストークンの取得

API実行時に必要なアクセストークンを取得します

```shell:/path/to/hoge
curl -d client_id={OAuthのクライアントID} -d client_secret={OAuthのクライアントシークレット} -d redirect_uri=urn:ietf:wg:oauth:2.0:oob -d grant_type=authorization_code -d code={さっき取得したコード} https://accounts.google.com/o/oauth2/token

# レスポンス
{
  &quot;access_token&quot; : &quot;xxxxxxxxxxxxxxxxx&quot;,
  &quot;token_type&quot; : &quot;Bearer&quot;,
  &quot;expires_in&quot; : 3600,
  &quot;refresh_token&quot; : &quot;xxxxxxxxxxxxxxxxxxxxx&quot;
}
```

## リフレッシュトークンからアクセストークンを取得

アクセストークンは30分で切れるらしいので、リフレッシュトークンから新しいトークンを再発行する為の手順です。（別に試すだけならやらなくてもよい)

```shell:/path/to/hoge
curl -d &quot;client_id={OAuthのクライアントID}&amp;client_secret={OAuthのクライアントシークレット}&amp;refresh_token={先ほど取得したrefresh_token}&amp;grant_type=refresh_token&quot; https://accounts.google.com/o/oauth2/token

# レスポンス
{
  &quot;access_token&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxx&quot;,
  &quot;token_type&quot; : &quot;Bearer&quot;,
  &quot;expires_in&quot; : 3600
}
```

このアクセストークンはAPI実行時に毎回必要になります。

### アクセストークンのパーミッションの確認方法

アクセストークンのscopeを適切に設定をしていないとAPIを実行した時に
「insufficientPermissions」というレスポンスが返ってきます。

パーミッションを確認するには

```
https://www.googleapis.com/oauth2/v1/tokeninfo?access_token={アクセストークン}
```

となります。

## Gmail メール一覧の取得

詳細は[Gmail API Users.messages: list](https://developers.google.com/gmail/api/)で


```shell:/path/to/hoge
curl -H &quot;Authorization: Bearer {先ほど取得したアクセストークン}&quot; https://www.googleapis.com/gmail/v1/users/me/messages/

#レスポンス

{
 &quot;messages&quot;: [
  {
   &quot;id&quot;: &quot;xxxxxx&quot;,
   &quot;threadId&quot;: &quot;xxxx&quot;
  },
  {
   &quot;id&quot;: &quot;xxxxxx&quot;,
   &quot;threadId&quot;: &quot;xxxx&quot;
  },
  {
   &quot;id&quot;: &quot;xxxxxx&quot;,
   &quot;threadId&quot;: &quot;xxxx&quot;
  },
   .
   .
   .
   .
  {
   &quot;id&quot;: &quot;xxxxxx&quot;,
   &quot;threadId&quot;: &quot;xxxx&quot;
  }
 ],
 &quot;nextPageToken&quot;: &quot;xxxxxxxx&quot;,
 &quot;resultSizeEstimate&quot;: 520
}
```

上記のidで特定のメールのメッセージの詳細を取得できます。

## Gmail メール本文の取得

詳細は[Gmail API Users.messages: get](https://developers.google.com/gmail/api/v1/reference/users/messages/get)で

```shell:/path/to/hoge
curl -H &quot;Authorization: Bearer {先ほど取得したアクセストークン}&quot; https://www.googleapis.com/gmail/v1/users/me/messages/{メール一覧で取得したid}

# レスポンス(一部抜粋)

 &quot;id&quot;: &quot;{メール一覧で取得したid}&quot;,
 &quot;threadId&quot;: &quot;メールのスレッドID&quot;,
 &quot;labelIds&quot;: [分類されているラベルID1,分類されているラベルID2],
 &quot;snippet&quot;: &quot;本文のスニペット&quot;,
 &quot;historyId&quot;: &quot;9052307&quot;,
 &quot;payload&quot;: {
  &quot;partId&quot;: &quot;&quot;,
  &quot;mimeType&quot;: &quot;text/plain&quot;,
  &quot;filename&quot;: &quot;&quot;,
  &quot;headers&quot;: [
   {
    &quot;name&quot;: &quot;Delivered-To&quot;,
    &quot;value&quot;: &quot;受信者のメールアドレス&quot;
   },
   {
    &quot;name&quot;: &quot;Received&quot;,
    &quot;value&quot;: &quot;by xx.xx.xx.xxx with SMTP id xxxxxx;        Thu, 25 Dec 2014 07:06:06 -0800 (PST)&quot;
   },
   {
    &quot;name&quot;: &quot;X-Received&quot;,
    &quot;value&quot;: &quot;by xx.xx.xx.xxx with SMTP id xxxxxx;        Thu, 25 Dec 2014 07:05:32 -0800 (PST)&quot;
   },
   {
    &quot;name&quot;: &quot;Return-Path&quot;,
    &quot;value&quot;: &quot;返信先のメールアドレス&quot;
   },
   {
    &quot;name&quot;: &quot;From&quot;,
    &quot;value&quot;: &quot;メールアドレス(From)&quot;
   },
   {
    &quot;name&quot;: &quot;to&quot;,
    &quot;value&quot;: &quot;メールアドレス(To)&quot;
   },
   {
    &quot;name&quot;: &quot;Cc&quot;,
    &quot;value&quot;: &quot;&quot;
   },
   {
    &quot;name&quot;: &quot;Date&quot;,
    &quot;value&quot;: &quot;Fri, 26 Dec 2014 00:05:26 +0900&quot;
   },
   {
    &quot;name&quot;: &quot;MIME-Version&quot;,
    &quot;value&quot;: &quot;1.0&quot;
   },
   {
    &quot;name&quot;: &quot;Content-Type&quot;,
    &quot;value&quot;: &quot;text/plain; charset=\&quot;iso-2022-jp\&quot;&quot;
   },
   {
    &quot;name&quot;: &quot;Content-Transfer-Encoding&quot;,
    &quot;value&quot;: &quot;7bit&quot;
   },
   {
    &quot;name&quot;: &quot;Subject&quot;,
    &quot;value&quot;: &quot;メールの件名&quot;
   },
   {
    &quot;name&quot;: &quot;Reply-To&quot;,
    &quot;value&quot;: &quot;返信先メールアドレス&quot;
   },
   {
    &quot;name&quot;: &quot;X-Mail-Count&quot;,
    &quot;value&quot;: &quot;2476689&quot;
   },
   {
    &quot;name&quot;: &quot;Precedence&quot;,
    &quot;value&quot;: &quot;bulk&quot;
   },
   {
    &quot;name&quot;: &quot;X-QuickML&quot;,
    &quot;value&quot;: &quot;true&quot;
   }
  ],
  &quot;body&quot;: {
   &quot;size&quot;: 1288,
   &quot;data&quot;: &quot;本文でベース64エンコードされた本文&quot;
  }
 },
 &quot;sizeEstimate&quot;: 3933
}
```

* メール件名
 * payload.headers[name: &quot;subject&quot;]
* メール本文
 * payload.body.data(base64urlエンコードされたもの)
 * [Online Base64URL decoder](http://kjur.github.io/jsjws/tool_b64udec.html)あたりで確認してみてください

になります。

なんか以外とメール取るのに苦労しました。。。。。(自分は)





</textarea><input type="submit" name="commit" value="Save changes" /></form></div></section>  <div class="text-advertisement">
      <span class="label label-info">PR</span>
      <a target="_blank" id="ad-48" href="https://teams.qiita.com/?utm_content=48&amp;utm_medium=text&amp;utm_source=qiita">社内メールでの情報共有をなくそう - Qiita:Team</a>
  </div>
  <script>
    $(function() {
      'use strict';
      Qiita.analysis.showAdvertisement({ adId: 48 })
      $('#ad-48').click(function() {
        Qiita.analysis.clickAdvertisement({
          type:  'text',
          place: 'bottom',
          adId:  48
        })
      });
    });
  </script>
<div class="itemsShowComment"><div class="itemsShowComment_wrapper" id="comments"><div class="js-comments"></div><div class="itemsShowCommentSignupOrLogin"><div class="itemsShowCommentSignupOrLogin_title">あなたもコメントしてみませんか :)</div><a class="btn btn-primary" track="click" data-label="RegisterToComment" href="/signup?redirect_to=%2Fryurock%2Fitems%2F4b063372ede81780c3c8%23comments">ユーザー登録(無料)</a><div class="itemsShowCommentSignupOrLogin_sub">すでにアカウントを持っている方は<a href="/login?redirect_to=%2Fryurock%2Fitems%2F4b063372ede81780c3c8%23comments">ログイン</a></div></div></div></div></div><div class="col-sm-3 itemsShowBody_subColumn"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="Google Gmail APIでメールを取得する by @ryurock3 on @Qiita" data-url="http://qiita.com/ryurock/items/4b063372ede81780c3c8" href="https://twitter.com/share">ツイート</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" data-hatena-bookmark-title="Google Gmail APIでメールを取得する - Qiita" href="http://b.hatena.ne.jp/entry/http://qiita.com/ryurock/items/4b063372ede81780c3c8" title="はてブに追加"><img alt="はてブに追加" height="20" src="http://b.st-hatena.com/images/entry-button/button-only.gif" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="http://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/ryurock/items/4b063372ede81780c3c8" data-size="medium"></div></div></div><script>$(function() {
  // Web Intents Javascript Events : https://dev.twitter.com/docs/intents/events#waiting-for-asynchronous-resources
  twttr.ready(function (twttr) {
    twttr.events.bind('tweet', function(event) {
      if (event) {
        Qiita.Mixpanel.tweetAnItem({ uuid: "4b063372ede81780c3c8" });
        ga('send', 'social', 'twitter', 'tweet', 'http://qiita.com');
        $.ajax({
          type: 'POST',
          url: '/notifications',
          data: {
            notification: {
              verb: 'tweet',
              uuid: "4b063372ede81780c3c8"
            }
          }
        });
      }
    });
    twttr.events.bind('click', function (e) {
      if (e) {
        ga('send', 'social', 'twitter', 'click', 'http://qiita.com');
      }
    });
  });
});</script><section class="itemsShowAuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/ryurock"><img alt="ryurock" class="itemsShowAuthorInfo_userIcon" itemprop="image" src="https://avatars.githubusercontent.com/u/1619084?v=3" /></a><div class="itemsShowAuthorInfo_profileStats"><strong class="itemsShowAuthorInfo_userName" itemprop="name"><a itemprop="url" href="/ryurock">ryurock</a></strong><div class="itemsShowAuthorInfo_contribution"><span class="itemsShowAuthorInfo_count">2420</span><span class="itemsShowAuthorInfo_unit">Contribution</span></div><span class="js-userFollowButton userFollowButton" data-position="author-info" data-url-name="ryurock"><form class="button_to" method="post" action="/ryurock/follow"><button class="btn btn-default btn-block userFollowButton_button-follow btn-xs" type="submit"><i class="fa fa-user-plus"></i>フォロー</button><input type="hidden" name="authenticity_token" value="7HKukjEsXiU+MjAifNvg1wekbCaRQVEWBqkltAZkKrGrulFkgOp/F2s5D9nn1vb+vXMlYBO/Y/koBpbcyH77jw==" /></form><div class="btn btn-primary btn-block userFollowButton_button-following btn-xs">フォロー中</div><form class="button_to" method="post" action="/ryurock/unfollow"><button class="btn btn-danger btn-block userFollowButton_button-unfollow btn-xs" type="submit">解除</button><input type="hidden" name="authenticity_token" value="/fYrpEim7TksJ1WdVdvG8NmMTCdgrMXQn7AuvnJVAeK6PtRS+WDMC3ksambO1tDZY1sFYeJS9z+xH53WvE/Q3A==" /></form></span></div><section class="itemsShowAuthorPopularItems"><h6 class="itemsShowAuthorPopularItems_sectionTitle">人気の投稿</h6><ul class="itemsShowAuthorPopularItems_posts list-unstyled"><li itemscope="" itemtype="http://schema.org/Article"><a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/ryurock/items/1432578d364985f6cb06">みんなhomebrew-caskって知ってるか？</a></li><li itemscope="" itemtype="http://schema.org/Article"><a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/ryurock/items/9c6de36b9d6a716e7992">なんかかっこいいプレゼンテーションテンプレートを探しているならreveal.js使ってみろって</a></li><li itemscope="" itemtype="http://schema.org/Article"><a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/ryurock/items/28690f2b1553601d684d">PackerでVagrant用のBoxを作成したときのメモ</a></li><li itemscope="" itemtype="http://schema.org/Article"><a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/ryurock/items/91df14537512c03488ac">vagrantの設定を色々調べて（試してみた）</a></li><li itemscope="" itemtype="http://schema.org/Article"><a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/ryurock/items/fe915a8b24b7c7f5c4a3">WEB開発をするにあたって私的「これだけは入れとけ!」っていう開発環境構築手順(virtualbox編)</a></li></ul></section></section><div class="scroll-chaser">  <div class="banner-advertisement">
      <a target="_blank" id="ad-53" href="http://shop.qiita.com/?utm_content=53&amp;utm_medium=banner&amp;utm_source=qiita">
        <img src="http://cdn.qiita.com/assets/tshrit-banner-31a3dc3731483238c56983ca5f15a90b.gif" />
</a>  </div>
  <script>
    $(function() {
      'use strict';
      Qiita.analysis.showAdvertisement({ adId: 53 })
      $('#ad-53').click(function() {
        Qiita.analysis.clickAdvertisement({
          type:  'banner',
          place: 'sidebar',
          adId:  53
        })
      });
    });
  </script>
<div class="js-tocAnchor"></div></div></div></div></div></article><script id="js-item" type="application/json">{ "url": "http://qiita.com/ryurock/items/4b063372ede81780c3c8", "id": 216119, "uuid": "4b063372ede81780c3c8" }</script><script class="js-user" type="application/json">{&quot;id&quot;:5564,&quot;url_name&quot;:&quot;ryurock&quot;,&quot;profile_image_url&quot;:&quot;https://avatars.githubusercontent.com/u/1619084?v=3&quot;}</script></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2015 Increments Inc.</a></li><li class="footer_link"><a href="http://qiita.com/terms">利用規約</a></li><li class="footer_link"><a href="http://qiita.com/privacy">プライバシー</a></li><li class="footer_link"><a href="http://help.qiita.com">ヘルプ</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">お問い合わせ</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="http://qiita.com/about">Qiitaとは</a></li><li class="footer_link"><a href="http://blog.qiita.com">ブログ</a></li><li class="footer_link"><a href="http://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a href="http://kobito.qiita.com">Kobito</a></li><li class="footer_link"><a href="http://career.qiita.com">Career</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> ご意見 <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">ご意見</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="EHHJXUvK8yWGKXYnVfD/l3UtEdiKUXQQTg52rNFocfdXuTar+gzSF9MiSdzO/em+z/pYngivRv9gocXEH3KgyQ==" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Qiitaについてのご意見をお聞かせください。" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> 送信</button><p class="feedbackForm_note">いただいたご意見への返信は行っておりません。<br />返信の必要な内容については、<a href="https://increments.zendesk.com/anonymous_requests/new">こちら</a> からお問い合わせください。</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>if (window.mixpanel instanceof Element) {
  window.mixpanel = [];
}
(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="http://cdn.qiita.com/assets/vendor-6334f981b8665070caa79dab4e9a0431.js"></script><script src="http://cdn.qiita.com/assets/application-e18a9b55ff7d50e79e69b240390e9ebf.js"></script><script>(function (I18n) {
  var match, orig;
  I18n.defaultLocale = "ja";
  I18n.fallbacks = true;
  if (match = location.search.match(/(?:\?|&)locale=([^&]+)/)) {
    I18n.locale = match[1];
    orig = $.ajax;
    $.ajax = function (params) {
      params.data || (params.data = {});
      params.data.locale = match[1];
      return orig.call($, params);
    };
  } else {
    I18n.locale = "ja";
  }
})(I18n);</script><script>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
          ga('create', 'UA-42040908-1', { name: 'user' });
          ga('user.send', 'pageview');
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</script>
</body></html>
